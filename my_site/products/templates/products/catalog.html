{% extends 'products/base.html' %}
{% load static cache %}
{% load catalog_tags %}


{% block main %}

<div class="container">
    <!--icon cards/table-->

    <div class="row mt-2">
        <div class="col-lg-3"></div>
        <div class="col-lg-9">
                <a href="{% url 'products_catalog' %}" class="btn btn-outline-secondary btn-sm">
                    <i class="fa-solid fa-table-cells-large fa-lg p-2"></i>
                </a>
                <a href="{% url 'table_view' %}" class="btn btn-outline-secondary btn-sm">
                    <i class="fa-solid fa-bars fa-lg p-2"></i>
                </a>
        </div>
    </div>
    <!--End icon cards/table-->

    <div class="row">
        <div class="col-lg-3">
            <!--        Filter categories-->
            <div class="list-group mt-4">
                {% if category_selected == 0 %}
                <a href="#"class="list-group-item disabled">Все категории</a>
                {% else %}
                <a href="{% url 'products_catalog' %}"class="list-group-item">Все категории</a>
                {% endif %}
                {% for category in categories %}
                    {% if category.product__count > 0 %}
                        {% if category.pk == category_selected %}
                            <a href="#"class="list-group-item disabled">{{category.name}}</a>
                        {%  else %}
                            <a href="{{category.get_absolute_url}}" class="list-group-item">{{category.name}}</a>
                        {% endif %}
                    {% endif %}
                {% endfor %}
            </div>
            <!--        End Filter categories-->
        </div>

        <div class="col-lg-9">
            {% if view_cards %}
            <!--Cards-->
            <div class="row row-cols-1 row-cols-md-3 g-4 mt-0 mb-4">
{#            {% cache 30 products %}#}

              {% for p in products %}
              <div class="col" id="{{ p.pk }}">
                <div class="card h-100">
                  {% if p.image %}
                  <img src="{{p.image.url}}" class="card-img-top"  alt="...">
                  {% endif %}
                  <div class="card-body text-center">
                    <h5 class="card-title"><a href="{{p.get_absolute_url}}">{{p.name}}</a></h5>
                    <h5>{{p.price}} руб.</h5>
                    <p class="card-text">Калибр: {{p.characteristic.caliber}} мм.</p>
                    <p class="card-text">Время работы: {{p.characteristic.time_work}} сек.</p>
{#                    <p class="card-text">{{p.description|linebreaks|truncatewords:20}}</p>#}
                  </div>
                  <div class="card-footer text-center" id="cardfooter{{ p.pk }}">
                    <div id="cardfooterdiv{{ p.pk }}">
                      {% if request.user.is_authenticated %}
                          {% if p.pk in baskets_product_id %}
                              <a href="{% url 'basket_minus_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">-</a>
                              <a href="#" class="btn btn-success disabled">{%  get_BasketAuth_product_amount request=request pk=p.pk %}</a>
                              <a href="{% url 'basket_add_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">+</a>
                          {% else %}
                              <a href="{% url 'basket_add_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">В корзину</a> {# В js используется id (№) для идентификации объекта из списка #}
                          {% endif %}
                      {% else %}
                          {% if p.pk in baskets_product_id %}
                              <a href="{% url 'basket_minus' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">-</a>
                              <a href="#" class="btn btn-success disabled">{%  get_BasketFk_product_amount request=request pk=p.pk %}</a>
                              <a href="{% url 'basket_add' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">+</a>
                          {% else %}
                              <a href="{% url 'basket_add' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                 id="{{ p.pk }}">В корзину</a> {# В js используется id (№) для идентификации объекта из списка #}
                          {% endif %}
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
              {% endfor %}

{#            {% endcache %}#}
            </div>
            <!--End Cards-->
            {% else %}
            <!--Table-->
            <div class="row row-cols-1 row-cols-md-3 g-4 mt-0 mb-4">
                <table class="table" style="margin-top: 14px">
                    <thead>
                    <tr>
                        <th scope="col">Артикль</th>
                        <th scope="col">Название</th>
                        <th scope="col"></th>
                        <th scope="col">Цена</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for p in products %}
                    <tr>
                        <td>{{ p.article }}</td>
                        <td>{{ p.name }}</td>
                        <td><img src="{{p.image.url}}" style="width: 50px; height: 50px"  alt="..."></td>
                        <td>{{ p.price }}.</td>
                        <td id="cardfooter{{ p.pk }}" style="width: 200px">
                            <div id="cardfooterdiv{{ p.pk }}">
                                {% if request.user.is_authenticated %}
                                    {% if p.pk in baskets_product_id %}
                                      <a href="{% url 'basket_minus_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">-</a>
                                      <a href="#" class="btn btn-success disabled">{%  get_BasketAuth_product_amount request=request pk=p.pk %}</a>
                                      <a href="{% url 'basket_add_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">+</a>
                                    {% else %}
                                      <a href="{% url 'basket_add_auth' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">В корзину</a> {# В js используется id (№) для идентификации объекта из списка #}
                                    {% endif %}
                                {% else %}
                                    {% if p.pk in baskets_product_id %}
                                      <a href="{% url 'basket_minus' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">-</a>
                                      <a href="#" class="btn btn-success disabled">{%  get_BasketFk_product_amount request=request pk=p.pk %}</a>
                                      <a href="{% url 'basket_add' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">+</a>
                                    {% else %}
                                      <a href="{% url 'basket_add' p.slug %}" class="btn btn-outline-success plus_or_minus_to_basket"
                                         id="{{ p.pk }}">В корзину</a> {# В js используется id (№) для идентификации объекта из списка #}
                                    {% endif %}
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            <!--End Table-->
            {% endif %}

            <!--Пагинация-->
            {% if page_obj.has_other_pages %}
                <nav aria-label="Page navigation example">
                  <ul class="pagination justify-content-center">
                      {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{page_obj.previous_page_number}}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                      {% endif %}
                      {% for p in paginator.page_range %}
                        {% if page_obj.number == p %}
                            <li class="page-item active" aria-current="page">
                                <a class="page-link" href="?page={{p}}">{{p}}<span class="sr-only"></span></a></li>
                        {% elif p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
                            <li class="page-item"><a class="page-link" href="?page={{p}}">{{p}}</a></li>
                        {% endif %}
                      {% endfor %}
                      {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{page_obj.next_page_number}}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                      {% endif %}
                  </ul>
                </nav>
            {% endif %}
            <!--Конец погинации-->
        </div>
    </div>
</div>
{% endblock main %}